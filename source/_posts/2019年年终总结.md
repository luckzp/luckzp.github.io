回顾1年工作的经历，现在想想能够让自己记忆深刻的事情，发现这些事情都是自己全身心投入进去的。

1. 物流轨迹项目

   从年初开始弄起，陆陆续续了弄了2,3个月。从最初接的快递鸟，采用数据库存储的方式。到现在采用Redis以物流单号为key,会员信息为value存储，对接了菜鸟。这个项目让我对RabbitMQ有了更深的了解，由于物流轨迹服务是不分集群的，根据不同队列会接受不同集群WMS的消息，然后订阅菜鸟。当菜鸟有消息过来时，又会将消息分发到不同集群的WMS，更新物流状态。一开始上线的时候，发现消息积压，20个消费者消费不了这么多消息，后来找尹凌英问了下调整到40个才解决。

   后来随着对RabbitMQ削峰解耦的理解，将原先订阅菠萝派的接口改成发消息订阅，提高WMS的吞吐量。

   物流轨迹目前这个功能还不够完善，只接了菜鸟，还有顺丰，京东，拼多多等平台还未对接。

2. 到印尼帮助得力上线吉客云。

   到印尼，这是我这辈子做飞机做的要腿软的一次，做了13个小时。到了印尼也不好过，本以为着有一天可以清闲点到处逛逛。后来，我算是被打脸了。跟飞哥天天待在仓库里，帮忙上线吉客云。再加上印尼是热带气候，天天30度在这待了十几天。本来天气又热，再加上这里的网络真的是烂。平均打开一个页面要个4s，后来好不容易上线了之后。回国后，一会Lazada的打印单子有问题，一会京东印尼打印单子有问题，又过一段时间Shoppe打印单子有问题。幸运的是，有欧世懿，何佳龙，黄景铺，董文华大佬们积极的帮助，一个个的帮客户解决。这个解决过程非常温馨的，当出了问题，大家都不逃避，不推脱，不埋怨他人，而是仅仅针对问题本身，一起想各种办法去解决。大家都有干劲，有激情，冲着一个目标去，这样工作的感觉非常棒。

   印尼那边依然还有问题待解决，道阻且长。

   PS:印尼人口有2亿多，市场潜力巨大，国内有滴滴，这里有go-jerk; 国内有美团，这里有Grab; 国内有淘宝，这里Tokopedia。很多与国内类似的商业模式在这里也成了独角兽。我在想，电商服务商是不是也可以复制到印尼了。

3. 对称重和打包的重构。

   历史代码针对不同输入的单号会各种if-else，阅读起来困难。当时借着多包裹的需求，直接用策略模式对其重构，扫描物流单号有物流单号的策略，扫描发货单号有发货单号的策略，扫描包裹号有包裹的策略。重构完后，自己看代码就清爽多了。

   顺便也把示范仓的流水线和打包设备一起对接。与北岱对接称重接口时，对方要求接口性能要好，也是优化，还好现在一直都没出问题了。

4. 直接发货的优化

   wms间隙性的会出现死锁，刘大专门做了个分享。对此，后来，我们WMS迅速修改代码。但接受对直接发货的改造时，一开始完全摸不到头脑的，觉得很复杂，要改的太多。后来想到多线程，但一开始对多线程不熟悉，就看了一些资料，看完后，实现了一番，发现经常死锁。本来准备放弃多线程的，和袁铭恩交流了下，告诉我还是要往多线程这边想想，就比如1000个单子1个人验货很慢，1000单10个人验货就会快很多。后来，我重新的实现了一遍扣减货位库存的逻辑，本地测的不死锁。后来一上线，没考虑到用户是十几个波次一起点直接发货，还是产生了死锁。辛亏当时将死锁的线程try catch了然后用了countDownLatch，让用户可以重试直接发货。当天的还在排查为啥死锁，这时候金林刚开完OKR会议后回来和我说：试下对货位-货品进行排序。经他这一提醒，我又想到了阿里规范的排序能减少死锁，立即发了hotfix。后来果然死锁没了。当然经过优化后，后来异步计算邮资，直接发货的效率提升了许多，以前发200单要7s，现在400单要1s。这个事情，看了很多资料，过程很艰辛，但是最后的结果很好，学到了很多，还是很开心。

