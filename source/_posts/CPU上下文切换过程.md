---
title: CPU上下文切换过程
urlname: drzgu5
date: 2020-09-11 14:51:03 +0800
tags: [操作系统]
categories: []
---

CPU 上下文切换过程：
当一个用户态的程序运行到一半，要访问一个核心资源，例如访问网卡发一个网络包，就需 要暂停当前的运行，调用系统调用，接下来就轮到内核中的代码运行了。首先，内核将从系统调用传过来的包，在网卡上排队，轮到的时候就发送。发送完了，系统 调用就结束了，返回用户态，让暂停运行的程序接着运行。这个暂停怎么实现呢？其实就是把程序运行到一半的情况保存下来。例如，我们知道，内存 是用来保存程序运行时候的中间结果的，现在要暂时停下来，这些中间结果不能丢，因为再 次运行的时候，还要基于这些中间结果接着来。另外就是，当前运行到代码的哪一行了，当 前的栈在哪里，这些都是在寄存器里面的。所以，暂停的那一刻，要把当时 CPU 的寄存器的值全部暂存到一个地方，这个地方可以放 在进程管理系统很容易获取的地方。在后面讨论进程管理数据结构的时候，我们还会详细 讲。当系统调用完毕，返回的时候，再从这个地方将寄存器的值恢复回去，就能接着运行了。
