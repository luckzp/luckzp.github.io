---
title: Mysql实战-学习笔记(2)
date: 2019-10-22 21:58:45
tags: Mysql
---

### 7 行锁功过：怎么减少行锁对性能的影响？

**两阶段锁协议**

在 InnoDB 事务中，行锁是在需要的时候才加上的，但并不是不需要了就立刻释放，而是要等到事务结束时才释放。在一个事务中，把最可能发生锁冲突的SQL语句放在最后，减少锁行的时间。

### 8 事务到底是隔离的还是不隔离的？

**可重复读**

事务 T 启动的时候会创建一个视图 read-view，之后事务 T 执行期间，即使有其他事务修改了数
据，事务 T 看到的仍然跟在启动时看到的一样。

一个事务启动的时候，能够看到所有已经提交的事务结果。但是之后，这个事务执行期间，其他事务的更新对它不可见。

**当前读VS快照读**

<!--more--> 

当事务隔离级别是可重复读时

- 快照读： 读取的是事务开启前的数据，比如 select

  ```sql
  select * from table …
  ```

- 当前读：总是读取已经提交完成的最新版本。特殊的读操作，插入 / 更新 / 删除操作，属于当前读，处理的都是当前的数据，需要加锁。

  ```sql
  select * from table where ? lock in share mode; S 锁，Gap 锁
  
  select * from table where ? for update; X 锁，Gap 锁
  
  insert; X 锁，Gap 锁
  
  update ; X 锁，Gap 锁
  
  delete; X 锁，Gap 锁
  ```

  

